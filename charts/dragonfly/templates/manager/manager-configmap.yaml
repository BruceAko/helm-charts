apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "dragonfly.manager.fullname" . }}
  namespace: {{ template "dragonfly.namespace" . }}
  labels:
    app: {{ template "dragonfly.fullname" . }}
    chart: "{{ .Chart.Name }}-{{ .Chart.Version }}"
    release: "{{ .Release.Name }}"
    heritage: "{{ .Release.Service }}"
data:
  manager.yaml: |-
    server:
      rest: 
        addr: :{{ .Values.manager.restPort }}
      grpc:
        port:
          start: {{ .Values.manager.grpcPort }}
          end: {{ .Values.manager.grpcPort }}
    database:
      mysql:
        user: {{ .Values.mysql.auth.username }}
        password: {{ .Values.mysql.auth.password }}
        {{- if .Values.mysql.enable }}
        host: {{ .Release.Name }}-{{ default "mysql" .Values.mysql.fullnameOverride }}
        {{- else }}
        host: {{ .Values.mysql.auth.host }}
        {{- end }}
        port: {{ .Values.mysql.primary.service.port }}
        dbname: {{ .Values.mysql.auth.database }}
        migrate: {{ .Values.mysql.migrate }}
      redis:
        password: {{ .Values.redis.password }}
        {{- if .Values.redis.enable }}
        host: {{ .Release.Name }}-{{ default "redis-cluster" .Values.redis.fullnameOverride }}
        {{- else }}
        host: {{ .Values.redis.host }}
        {{- end }}
        port: {{ .Values.redis.service.port }}
